{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Survey Builder</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="{% static 'main/Css/surveyBuilder_admin.css' %}">
</head>
<body>
<!-- Hidden survey data for editing -->
  {% if survey_data %}
    <div id="surveyData" style="display: none;">{{ survey_data|safe }}</div>
  {% endif %}
  <div class="shell">
 <div class="topbar">
  <div class="actions">
    <button id="btnNew" class="btn btn-ghost"><i class="bi bi-plus-lg"></i> New survey</button>

    <!-- Save as draft -->
    <button
      id="btnSave"
      class="btn btn-primary"
      type="submit"
      form="surveySettingsForm"
      name="action"
      value="draft">
      Save Draft
    </button>

    <div class="split">
      <!-- Publish -->
      <button
        id="btnPublish"
        class="btn btn-primary"
        type="submit"
        form="surveySettingsForm"
        name="action"
        value="publish">
        Publish Survey
      </button>

      <button class="btn btn-primary split-caret" id="btnMenu"><i class="bi bi-caret-down-fill"></i></button>
      <ul class="menu" id="menu">
        <li><button id="btnExport" class="menu-item"><i class="bi bi-braces"></i> Export JSON</button></li>
      </ul>
    </div>
  </div>
</div>



    <div class="grid">
      <!-- Toolbox (buttons are draggable) -->
      <aside id="toolbox" class="panel toolbox">
        <div class="panel-title"><i class="bi bi-grid-3x3-gap me-1"></i>Question Toolbox</div>

        <!-- Tools -->
        <button class="tool" draggable="true" data-type="multiple_choice">
          <i class="bi bi-ui-radios-grid"></i> Multiple Choice
        </button>
        <button class="tool" draggable="true" data-type="likert">
          <i class="bi bi-stars"></i> Likert Scale
        </button>
        <button class="tool" draggable="true" data-type="short_answer">
          <i class="bi bi-input-cursor-text"></i> Short Answer
        </button>
      </aside>

      <!-- Canvas -->
      <main class="canvas panel">
        <div id="canvas" class="canvas-inner" ondragover="event.preventDefault()"></div>
      </main>

      <!-- Settings -->
      <aside class="panel settings">
        <div class="breadcrumbs">
  Dashboard • Survey •
  {% if edit_survey %}
    Edit: {{ edit_survey.title }}
  {% else %}
    Builder
  {% endif %}
</div>
        <h3>Survey Settings</h3>

        <!-- You can wrap in a form if you plan to POST -->
<form id="surveySettingsForm" method="post" action="{% url 'survey_builder' %}">
  {% csrf_token %}

  <!-- Hidden input for editing -->
  {% if edit_survey %}
    <input type="hidden" name="survey_id" value="{{ edit_survey.survey_id }}">
  {% endif %}

  <!-- Hidden input for questions -->
  <input type="hidden" id="questionsData" name="questions">

  <!-- Survey Title -->
  <label class="label" for="surveyTitle">Survey Title</label>
  <div class="field">
    <input
      type="text"
      id="surveyTitle"
      name="title"
      class="control"
      autocomplete="off"
      required
    >
  </div>

  <!-- Survey Description -->
  <label class="label" for="surveyDescription">Description</label>
  <div class="field">
    <textarea
      id="surveyDescription"
      name="description"
      class="control"
      rows="4"
    ></textarea>
  </div>

  <!-- Assign To (Class Sections) -->
  <label class="label">Assign to</label>
  <div class="field">
    <div id="sectionSelectorsContainer">
      <!-- Initial dropdown row -->
      <div class="section-selector-row">
        <select class="section-dropdown" required>
          <option value="">— Select Section —</option>
          {% for section in sections %}
            <option value="{{ section.class_id }}">
              {{ section.class_name }} (Year {{ section.year_level }})
            </option>
          {% empty %}
            <option disabled>No sections available</option>
          {% endfor %}
        </select>
        <button type="button" class="section-btn remove-section" title="Remove">
          <i class="bi bi-dash-lg"></i>
        </button>
      </div>
    </div>

    <!-- Add button below all dropdowns -->
    <button type="button" id="addSectionBtn" class="btn-add-section">
      <i class="bi bi-plus-circle"></i> Add Another Section
    </button>

    <input type="hidden" id="selectedSectionsInput" name="selectedSections" required>
  </div>

  <!-- Due Date -->
  <label class="label" for="dueDate">Due Date</label>
  <div class="field with-icon">
    <input type="date" id="dueDate" name="dueDate">
    <i id="dateIcon" class="bi bi-calendar3 field-icon"></i>
  </div>

</form>
      </aside>
    </div>

    <!-- Footer -->
    <div class="footer">
      <button id="btnPreview" class="btn btn-ghost">Preview Survey</button>
      <button id="btnBack" class="btn btn-ghost">Back to Dashboard</button>
    </div>
  </div>

<!-- Publish Confirmation Modal -->
<div id="publishModalOverlay" class="modal-overlay">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="modal-header">
      <div class="modal-title">
        <i class="bi bi-check-circle me-2"></i>Confirm Publish
      </div>
    </div>
    <div class="modal-body">
      <p>Are you sure you want to publish this survey?</p>
      <p><small class="text-muted">Once published, students will be able to see and answer this survey.</small></p>
    </div>
    <div class="modal-footer">
      <button id="publishModalCancel" class="btn btn-ghost">Cancel</button>
      <button id="publishModalConfirm" class="btn btn-primary">Publish Survey</button>
    </div>
  </div>
</div>

<!-- Back Confirmation Modal -->
<div id="backModalOverlay" class="modal-overlay">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="modal-header">
      <div class="modal-title">
        <i class="bi bi-exclamation-triangle me-2"></i>Unsaved Changes
      </div>
    </div>
    <div class="modal-body">
      <p>You have unsaved changes. Are you sure you want to leave?</p>
      <p><small class="text-danger">Your changes will be lost if you don't save them.</small></p>
    </div>
    <div class="modal-footer">
      <button id="backModalCancel" class="btn btn-ghost">Stay</button>
      <button id="backModalConfirm" class="btn btn-primary">Leave</button>
    </div>
  </div>
</div>

  <!-- Modal: New Survey -->
  <div id="modalOverlay" class="modal-overlay">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-header">
        <div id="modalTitle" class="modal-title">
          <i class="bi bi-exclamation-triangle me-2"></i>Start a new survey?
        </div>
      </div>
      <div class="modal-body">
        This will clear your current draft. You can’t undo this action.
      </div>
      <div class="modal-footer">
        <button id="modalCancel" class="btn btn-ghost">Cancel</button>
        <button id="modalConfirm" class="btn btn-primary">Start New</button>
      </div>
    </div>
  </div>

<!-- Save Draft Confirmation Modal -->
<div id="saveDraftModalOverlay" class="modal-overlay">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="modal-header">
      <div class="modal-title">
        <i class="bi bi-save me-2"></i>Save as Draft
      </div>
    </div>
    <div class="modal-body">
      <p>Save this survey as a draft?</p>
      <p><small class="text-muted">You can continue editing it later before publishing.</small></p>
    </div>
    <div class="modal-footer">
      <button id="saveDraftModalCancel" class="btn btn-ghost">Cancel</button>
      <button id="saveDraftModalConfirm" class="btn btn-primary">Save Draft</button>
    </div>
  </div>
</div>

  <!-- Scripts -->
  <script src="{% static 'main/Javascript/surveyBuilder_admin.js' %}"></script>
</body>
</html>
