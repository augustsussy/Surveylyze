{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Survey Builder</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="{% static 'main/css/surveyBuilder_admin.css' %}">
</head>
<body>
   <div id="builder-state"
       data-state='{{ builder_state_json|default:""|escapejs }}'>
  </div>
  {# ====== step 4a: data for JS (edit mode + preloaded state) ====== #}
  <div id="builder-data"
       data-state='{{ builder_state_json|default:""|escapejs }}'
       data-editing="{{ editing|default:False|yesno:'true,false' }}"
       data-survey-id="{{ survey_id|default:'' }}">
  </div>

  <div class="shell">
    <div class="topbar">
      <div class="actions">
        <button id="btnNew" class="btn btn-ghost">
          <i class="bi bi-plus-lg"></i> New survey
        </button>

        <!-- Save as draft -->
        <button
          id="btnSave"
          class="btn btn-primary"
          type="submit"
          form="surveySettingsForm"
          name="action"
          value="draft">
          Save Draft
        </button>

        <div class="split">
          <!-- Publish -->
          <button
            id="btnPublish"
            class="btn btn-primary"
            type="submit"
            form="surveySettingsForm"
            name="action"
            value="publish">
            Publish Survey
          </button>

          <button class="btn btn-primary split-caret" id="btnMenu">
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <ul class="menu" id="menu">
            <li>
              <button id="btnExport" class="menu-item">
                <i class="bi bi-braces"></i> Export JSON
              </button>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="grid">
      <!-- Toolbox (buttons are draggable) -->
      <aside id="toolbox" class="panel toolbox">
        <div class="panel-title"><i class="bi bi-grid-3x3-gap me-1"></i>Question Toolbox</div>

        <!-- Tools -->
        <button class="tool" draggable="true" data-type="multiple_choice">
          <i class="bi bi-ui-radios-grid"></i> Multiple Choice
        </button>
        <button class="tool" draggable="true" data-type="likert">
          <i class="bi bi-stars"></i> Likert Scale
        </button>
        <button class="tool" draggable="true" data-type="short_answer">
          <i class="bi bi-input-cursor-text"></i> Short Answer
        </button>
      </aside>

      <!-- Canvas -->
      <main class="canvas panel">
        <div id="canvas" class="canvas-inner" ondragover="event.preventDefault()"></div>
      </main>

      <!-- Settings -->
      <aside class="panel settings">
        <div class="breadcrumbs">Dashboard • Survey • Builder</div>
        <h3>Survey Settings</h3>

        <!-- You can wrap in a form if you plan to POST -->
        <form id="surveySettingsForm" method="post" action="{% url 'survey_builder' %}">
          {% csrf_token %}

          {# ====== step 4b: identify which survey is being edited ====== #}
          <input type="hidden" name="survey_id" id="surveyIdField" value="{{ survey_id|default:'' }}">

          <!-- hidden JSON for questions -->
          <input type="hidden" id="questionsData" name="questions">

          <!-- Survey Title -->
          <label class="label" for="surveyTitle">Survey Title</label>
          <div class="field">
            <input
              type="text"
              id="surveyTitle"
              name="title"
              class="control"
              autocomplete="off"
              required
            >
          </div>

          <!-- Survey Description -->
          <label class="label" for="surveyDescription">Description</label>
          <div class="field">
            <textarea
              id="surveyDescription"
              name="description"
              class="control"
              rows="4"
            ></textarea>
          </div>

          <!-- Assign To (Class Sections) -->
          <label class="label">Assign to</label>
          <div class="field with-icon">
            <select id="assignTo" name="assignTo" required>
              <option value="">— Select Section —</option>
              {% for section in sections %}
                <option value="{{ section.class_id }}">
                  {{ section.class_name }} (Year {{ section.year_level }})
                </option>
              {% empty %}
                <option disabled>No sections available</option>
              {% endfor %}
            </select>
            <i class="bi bi-chevron-down field-icon"></i>
          </div>

          <!-- Due Date -->
          <label class="label" for="dueDate">Due Date</label>
          <div class="field with-icon">
            <input type="date" id="dueDate" name="dueDate">
            <i id="dateIcon" class="bi bi-calendar3 field-icon"></i>
          </div>

          <!-- Status -->
          <div class="row-inline">
            <span class="label m-0">Status</span>
            <label class="switch">
              <input type="checkbox" id="statusToggle" name="status">
              <span class="slider"></span>
            </label>
          </div>
        </form>
      </aside>
    </div>

    <!-- Footer -->
    <div class="footer">
      <button id="btnPreview" class="btn btn-ghost">Preview Survey</button>
      <button id="btnBack" class="btn btn-ghost">Back to Dashboard</button>
    </div>
  </div>

  <!-- Modal: New Survey -->
  <div id="modalOverlay" class="modal-overlay">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-header">
        <div id="modalTitle" class="modal-title">
          <i class="bi bi-exclamation-triangle me-2"></i>Start a new survey?
        </div>
      </div>
      <div class="modal-body">
        This will clear your current draft. You can’t undo this action.
      </div>
      <div class="modal-footer">
        <button id="modalCancel" class="btn btn-ghost">Cancel</button>
        <button id="modalConfirm" class="btn btn-primary">Start New</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="{% static 'main/Javascript/surveyBuilder_admin.js' %}"></script>
</body>
</html>
