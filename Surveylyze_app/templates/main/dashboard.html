{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Dashboard</title>
  <link rel="stylesheet" href="{% static 'main/css/dashboard.css' %}">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
  <section class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="profile-card">
        <!-- Avatar: student profile picture with fallback -->
        <div class="avatar-wrapper">
          {% if student.profile_picture %}
            <img src="{{ student.profile_picture.url }}" alt="Profile" class="avatar">
          {% else %}
            <img src="{% static 'main/images/default_pfp.png' %}" alt="Profile" class="avatar">
          {% endif %}
        </div>

        <!-- Student Info -->
        <div class="profile-info">
          <h4>
            {{ student.firstname }}
            {% if student.middlename %} {{ student.middlename }} {% endif %}
            {{ student.lastname }}
          </h4>

          <p>ID: {{ student.student_id }}</p>
          <p>Section: {{ student.class_section.class_name }}</p>
        </div>

        <!-- Icons -->
        <div class="icons">
          <i data-lucide="bell"></i>
          <a href="{% url 'student_settings' %}">
            <i data-lucide="settings"></i>
          </a>
        </div>
      </div>

      <nav class="menu">
        <a href="#" class="menu-item">
          <i data-lucide="bar-chart-3"></i>
          <span>Response History</span>
        </a>

        <a href="#" class="menu-item">
          <i data-lucide="clipboard-list"></i>
          <span>Assigned Surveys</span>
        </a>

        <a href="{% url 'student_settings' %}" class="menu-item">
          <i data-lucide="user-cog"></i>
          <span>Settings</span>
        </a>

        <!-- Logout -->
        <form action="{% url 'logout' %}" method="post" class="logout-form">
          {% csrf_token %}
          <button type="submit" class="menu-item logout-btn">
            <i data-lucide="log-out"></i>
            <span>Logout</span>
          </button>
        </form>
      </nav>
    </aside>

    <!-- Main content -->
    <main class="content">
      <h2 class="title">STUDENT DASHBOARD</h2>
      <div class="dashboard-grid">

        <!-- RESPONSE HISTORY -->
        <div class="card history">
          <h3>RESPONSE HISTORY</h3>

          <!-- Search + filters form -->
          <form method="get" class="search-filter">
            <input
              type="text"
              name="q"
              placeholder="Search by title"
              class="search-bar"
              value="{{ request.GET.q }}"
            >

            <select name="order">
              <option value="newest"
                {% if request.GET.order == "newest" or not request.GET.order %}selected{% endif %}>
                Newest
              </option>
              <option value="oldest"
                {% if request.GET.order == "oldest" %}selected{% endif %}>
                Oldest
              </option>
            </select>

            <!-- status filter is just visual for now -->
            <select name="status" disabled>
              <option>Status</option>
              <option selected>Completed</option>
            </select>

            <!-- hidden button so Enter in the input submits the form -->
            <button type="submit" class="search-submit" style="display:none;"></button>
          </form>

          <div class="response-table">
            <div class="table-row header">
              <div class="col">Survey</div>
              <div class="col">Date</div>
              <div class="col">Status</div>
            </div>

            <div class="table-body">
              {% if responses %}
                {% for history in responses %}
                  <div class="table-row">
                    <div class="col">
                      <a href="{% url 'response_history' history.history_id %}"
                         class="response-link">
                        {{ history.survey.title }}
                      </a>
                    </div>
                    <div class="col">
                      {{ history.submitted_at|date:"F d, Y" }}
                    </div>
                    <div class="col status completed">
                      Completed
                    </div>
                  </div>
                {% endfor %}
              {% else %}
                <div class="table-row">
                  <div class="col">No responses found.</div>
                  <div class="col"></div>
                  <div class="col"></div>
                </div>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- ASSIGNED SURVEYS -->
        <div class="card assigned-surveys">
          <h3>ASSIGNED SURVEY</h3>

          {% if surveys %}
            <div class="survey-card-list">
              {% for survey in surveys %}
                <div class="survey-card">
                  <div class="survey-card-main">
                    <h4 class="survey-card-title">{{ survey.title }}</h4>

                    <p class="survey-card-row">
                      <span class="label">Status:</span>
                      {% if survey.status == "closed" %}
                        <span class="status-badge status-closed">Closed</span>
                      {% else %}
                        <span class="status-badge status-open">Open</span>
                      {% endif %}
                    </p>

                    <p class="survey-card-row">
                      <span class="label">Deadline:</span>
                      {% if survey.due_date %}
                        <span class="deadline-date">
                          {{ survey.due_date|date:"F d, Y" }}
                        </span>
                      {% else %}
                        <span class="deadline-date no-deadline">No deadline</span>
                      {% endif %}
                    </p>
                  </div>

                  <div class="survey-card-actions">
                    {% if survey.status == "closed" %}
                      <button class="btn-take-survey disabled" disabled>
                        Closed
                      </button>
                    {% else %}
                      <a href="{% url 'take_survey' survey.survey_id %}"
                         class="btn-take-survey">
                        Take Survey
                      </a>
                    {% endif %}
                  </div>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <p class="no-surveys">No surveys assigned to your section right now.</p>
          {% endif %}
        </div>

      </div>
    </main>
  </section>

  <footer>
    <p>Â© 2025 SURVEYLYZE | All rights reserved.</p>
  </footer>

  <script>
    lucide.createIcons();
  </script>
</body>
</html>
