{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Dashboard</title>
  <link rel="stylesheet" href="{% static 'main/css/dashboard.css' %}">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
  <section class="dashboard">
    <!-- Hover Sidebar -->
    <aside class="sidebar">
      <div class="profile-card">
        <img src="{% static 'main/images/profile.png' %}" alt="Profile" class="avatar">
        <div class="profile-info">
          <h4>{{ user.first_name }} {{ user.last_name }}</h4>
          <p>ID: {{ user.id }}</p>
          <p>Section: {{ user.student_profile.class_section.class_name }}</p>
        </div>
        <div class="icons">
          <i data-lucide="bell"></i>
          <i data-lucide="settings"></i>
        </div>
      </div>

      <nav class="menu">
        <a href="#" class="menu-item">
          <i data-lucide="bar-chart-3"></i>
          <span>Response History</span>
        </a>
        <a href="#" class="menu-item">
          <i data-lucide="clipboard-list"></i>
          <span>Assigned Surveys</span>
        </a>
        <a href="#" class="menu-item">
          <i data-lucide="user-cog"></i>
          <span>Settings</span>
        </a>

        <!-- ✅ Logout Button -->
        <form action="{% url 'logout' %}" method="post" class="logout-form">
          {% csrf_token %}
          <button type="submit" class="menu-item logout-btn">
            <i data-lucide="log-out"></i>
            <span>Logout</span>
          </button>
        </form>
      </nav>
    </aside>

    <!-- Main content -->
    <main class="content">
      <h2 class="title">STUDENT DASHBOARD</h2>
      <div class="dashboard-grid">

        <!-- RESPONSE HISTORY (placeholder/static for now) -->
        <div class="card history">
          <h3>RESPONSE HISTORY</h3>

          <div class="search-filter">
            <input type="text" placeholder="Search by title" class="search-bar">
            <select>
              <option>Date</option>
              <option>Newest</option>
              <option>Oldest</option>
            </select>
            <select>
              <option>Status</option>
              <option>Completed</option>
              <option>In Progress</option>
            </select>
          </div>

          <div class="response-table">
            <div class="table-row header">
              <div class="col">Survey</div>
              <div class="col">Date</div>
              <div class="col">Status</div>
            </div>

            <div class="table-body">
              <div class="table-row">
                <div class="col">Group Project Reflection</div>
                <div class="col">November 30, 2025</div>
                <div class="col status in-progress">On Progress</div>
              </div>

              <div class="table-row">
                <div class="col">Library Satisfaction Survey</div>
                <div class="col">November 28, 2025</div>
                <div class="col status completed">Completed</div>
              </div>

              <div class="table-row">
                <div class="col">Campus Survey</div>
                <div class="col">November 20, 2025</div>
                <div class="col status completed">Completed</div>
              </div>
            </div>
          </div>
        </div>

        <!-- ✅ ASSIGNED SURVEYS (card style) -->
        <div class="card assigned-surveys">
          <h3>ASSIGNED SURVEY</h3>

          {% if surveys %}
            <div class="survey-card-list">
              {% for survey in surveys %}
                <div class="survey-card">
                  <div class="survey-card-main">
                    <h4 class="survey-card-title">{{ survey.title }}</h4>

                    <p class="survey-card-row">
                      <span class="label">Status:</span>
                      {% if survey.status == "closed" %}
                        <span class="status-badge status-closed">Closed</span>
                      {% else %}
                        {# students only see published/closed, so published = Open #}
                        <span class="status-badge status-open">Open</span>
                      {% endif %}
                    </p>

                    <p class="survey-card-row">
                      <span class="label">Deadline:</span>
                      {% if survey.due_date %}
                        <span class="deadline-date">
                          {{ survey.due_date|date:"F d, Y" }}
                        </span>
                      {% else %}
                        <span class="deadline-date no-deadline">No deadline</span>
                      {% endif %}
                    </p>
                  </div>

                  <div class="survey-card-actions">
                    {% if survey.status == "closed" %}
                      <button class="btn-take-survey disabled" disabled>
                        Closed
                      </button>
                    {% else %}
                      <a href="{% url 'take_survey' survey.survey_id %}"
                         class="btn-take-survey">
                        Take Survey
                      </a>
                    {% endif %}
                  </div>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <p class="no-surveys">No surveys assigned to your section right now.</p>
          {% endif %}
        </div>

      </div>
    </main>
  </section>

  <footer>
    <p>© 2025 SURVEYLYZE | All rights reserved.</p>
  </footer>

  <script>
    lucide.createIcons();
  </script>
</body>
</html>
