{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Analytics Dashboard</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800display=swap" rel="stylesheet">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- Your CSS -->
  <link rel="stylesheet" href="{% static 'main/Css/analytics_admin.css' %}">
</head>
<body>
<div id="analytics-data" style="display:none;"
     data-metrics="{{ metrics }}"
     data-question-analytics="{{ question_analytics }}">
</div>
<div class="app-wrapper">
  <div class="row g-3">
    <!-- Sidebar -->
    <div class="col-12 col-lg-3">
      <div class="sidebar">
        <div class="profile mb-2">
          <!-- avatar now uses Teacher.profile_picture -->
          <div class="avatar me-2">
            {% if teacher.profile_picture %}
              <img src="{{ teacher.profile_picture.url }}" alt="Profile picture" class="avatar-img">
            {% else %}
              <!-- fallback circle / initials -->
            {% endif %}
          </div>

          <!-- name now comes from Teacher model -->
          <div>
            <div>{{ teacher.firstname }} {{ teacher.lastname }}</div>
            <div class="role text-muted small">
              {% if user.is_superuser %}Administrator{% else %}Teacher{% endif %}
            </div>
          </div>

          <div class="ms-auto d-flex gap-2 align-items-center">
            <i class="bi bi-bell"></i>
            <a href="{% url 'teacher_settings' %}">
              <i class="bi bi-gear"></i>
            </a>
          </div>
        </div>

        <nav class="nav flex-column mt-2">
          <a class="nav-link active" href="{% url 'analytics_admin' %}">Analytics Dashboard</a>
          <a class="nav-link" href="{% url 'survey_builder' %}">Survey Builder</a>
          <a class="nav-link" href="{% url 'my_surveys' %}">My Surveys</a>
          <a class="nav-link" href="{% url 'admin_responses' %}">Responses</a>
        </nav>

        <!-- Logout Button -->
        <form action="{% url 'logout' %}" method="post" class="mt-3">
          {% csrf_token %}
          <button type="submit" class="btn btn-outline-danger w-100">
            <i class="bi bi-box-arrow-right"></i> Logout
          </button>
        </form>
      </div>
    </div>

    <!-- Main -->
    <div class="col-12 col-lg-9">
      <div class="panel">
        <!-- Survey Selector Dropdown -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div class="section-title mb-0">
            {% if selected_survey %}
              Analytics: {{ selected_survey.title }}
            {% else %}
              Responses Overview (All Surveys)
            {% endif %}
          </div>

          <form method="get" class="survey-filter-form">
            <select name="survey_id" class="form-select" onchange="this.form.submit()" style="min-width: 250px;">
              <option value="all" {% if selected_survey_id == 'all' %}selected{% endif %}>
                ðŸ“Š All Surveys
              </option>
              {% for survey in all_surveys %}
                <option value="{{ survey.survey_id }}"
                        {% if selected_survey_id_int == survey.survey_id %}selected{% endif %}>
                  {{ survey.title }} ({{ survey.status }})
                </option>
              {% endfor %}
            </select>
          </form>
        </div>

        <!-- Top stats -->
        <div class="row g-3 mb-2">
          <div class="col-12 col-md-4">
            <div class="card card-lite stat p-3">
              <div class="label">Total Surveys</div>
              <div class="value" id="stat-total">â€“</div>
              <div class="sub">Surveys Created</div>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="card card-lite stat p-3">
              <div class="label">Responses Received</div>
              <div class="value" id="stat-submissions">â€“</div>
              <div class="sub">Submissions</div>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="card card-lite stat p-3">
              <div class="label">Active Surveys</div>
              <div class="value" id="stat-active">â€“</div>
              <div class="sub">Currently Open</div>
            </div>
          </div>
        </div>

        <!-- Charts -->
        <div id="question-analytics-container" class="mt-4">
          <!-- JavaScript will populate this -->
        </div>

      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Your JS -->
  <script src="{% static 'main/Javascript/analytics_admin.js' %}"></script>
</body>
</html>
